<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.2072d913c063a542f3b5.css">/*! modern-normalize | MIT License | https://github.com/sindresorhus/modern-normalize */html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}hr{height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{padding:0}progress{vertical-align:baseline}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}</style><meta name="generator" content="Gatsby 2.13.22"/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="canonical" href="https://gatsby-starter-typescript-plus.netlify.com/api/DeclaredAPI/implementWithMiddleware/" data-baseprotocol="https:" data-basehost="gatsby-starter-typescript-plus.netlify.com"/><title data-react-helmet="true">Papupata Documentation</title><meta data-react-helmet="true" name="description" content="Documentation for the typescript library papupata, for utilizing types for AJAX requests."/><meta data-react-helmet="true" name="keywords"/><link as="script" rel="preload" href="/webpack-runtime-b250d0c9b07cb4c16ee5.js"/><link as="script" rel="preload" href="/app-be965acda842c5448fb8.js"/><link as="script" rel="preload" href="/styles-55dc67248799c1c1094b.js"/><link as="script" rel="preload" href="/1-9232275627ef4d5a43ec.js"/><link as="script" rel="preload" href="/2-1e0f04a221fa422f9089.js"/><link as="script" rel="preload" href="/component---src-pages-api-declared-api-implement-with-middleware-tsx-38c7ace3cb2b9817551e.js"/><link as="fetch" rel="preload" href="/page-data/api/DeclaredAPI/implementWithMiddleware/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="u9b51k">html{box-sizing:border-box;}*,*::before,*::after{box-sizing:inherit;}html{font-size:16px !important;line-height:1.45 !important;}body{width:100%;overflow-x:hidden;overflow-y:scroll;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif;color:#000;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;}a{color:#663399;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:focus{-webkit-text-decoration:underline;text-decoration:underline;}img{max-width:100%;object-fit:contain;position:relative;}figure{margin:2rem 0;}figcaption{font-size:80%;}table{width:100%;margin-bottom:1rem;border:1px solid #f5f3f7;font-size:85%;border-collapse:collapse;}td,th{padding:.25rem .5rem;border:1px solid #f5f3f7;}th{text-align:left;}tbody tr:nth-of-type(odd) td{background-color:#fbfafc;}tbody tr:nth-of-type(odd) tr{background-color:#fbfafc;}h1,h2,h3,h4,h5,h6{margin-top:1.414rem;margin-bottom:.5rem;color:#000;font-weight:600;line-height:1.2;text-rendering:optimizeLegibility;}h1{margin-top:0;font-size:2.441rem;}h2{font-size:1.953rem;}h3{font-size:1.563rem;}h4,h5,h6{font-size:1.25rem;}p{margin-top:0;margin-bottom:1rem;}strong{color:#000;}ul,ol,dl{margin-top:0;margin-bottom:1rem;}dt{font-weight:bold;}dd{margin-bottom:.5rem;}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #f5f3f7;}blockquote{margin:.8rem 0;padding:.5rem 1rem;border-left:.25rem solid #f5f3f7;color:rgba(0,0,0,0.54);}blockquote p:last-child{margin-bottom:0;}@media (min-width:48em){blockquote{padding-right:5rem;padding-left:1.25rem;}}</style><style data-emotion-css="zf0iqh">.css-zf0iqh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}</style><div class="css-zf0iqh e17su9850"><style data-emotion-css="1atnuaa">.css-1atnuaa{height:60px;padding:0 1.5rem;background-color:#663399;color:rgba(255,255,255,0.5);}</style><header class="css-1atnuaa e14yya1q0"><style data-emotion-css="voneje">.css-voneje{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;}</style><style data-emotion-css="8gr2bf">.css-8gr2bf{position:relative;margin-left:auto;margin-right:auto;width:auto;max-width:60em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;}</style><div class="e14yya1q1 css-8gr2bf e1c6zxln0"><style data-emotion-css="1u0571z">.css-1u0571z{color:#fff;font-size:1.5rem;font-weight:600;}.css-1u0571z:hover,.css-1u0571z:focus{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-1u0571z e14yya1q2" href="/">Papupata Documentation</a></div></header><div class="sc-EHOje fhxHOS"><div class="sc-bwzfXH jCJMgF"><h2 class="sc-htpNat KtFsv">Table of contents</h2><div><a current="false" class="sc-bdVaJa eDCunu" href="/what-is-papupata">What is papupata?</a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/getting-started">Getting started</a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api-reference">API Reference</a></div><div class="sc-bxivhb hlesxE"><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/APIDeclaration">class APIDeclaration</a></div><div class="sc-bxivhb hlesxE"><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/APIDeclaration/configure"><span>configure<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/APIDeclaration/declareDeleteAPI"><span>declareDeleteAPI<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/APIDeclaration/declareGetAPI"><span>declareGetAPI<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/APIDeclaration/declarePostAPI"><span>declarePostAPI<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/APIDeclaration/declarePutAPI"><span>declarePutAPI<!-- -->()</span></a></div></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/IncompleteAPIDeclaration">IncompleteAPIDeclaration</a></div><div class="sc-bxivhb hlesxE"><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/IncompleteAPIDeclaration/params"><span>params<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/IncompleteAPIDeclaration/query"><span>query<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/IncompleteAPIDeclaration/optionalQuery"><span>optionalQuery<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/IncompleteAPIDeclaration/queryBool"><span>queryBool<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/IncompleteAPIDeclaration/body"><span>body<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/IncompleteAPIDeclaration/response"><span>response<!-- -->()</span></a></div></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI">DeclaredAPI</a></div><div class="sc-bxivhb hlesxE"><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/invoke"><span>()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/getURL"><span>getURL<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/implement"><span>implement<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/implementWithMiddleware"><span>implementWithMiddleware<!-- -->()</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/ResponseType"><span class="sc-ifAKCX fgJOcI">ResponseType</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/ServerResponseType"><span class="sc-ifAKCX fgJOcI">ServerResponseType</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/BodyType"><span class="sc-ifAKCX fgJOcI">BodyType</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/CallArgsType"><span class="sc-ifAKCX fgJOcI">CallArgsType</span></a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/DeclaredAPI/RequestType"><span class="sc-ifAKCX fgJOcI">RequestType</span></a></div></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/fetchAdapter">fetchAdapter</a></div><div><a current="false" class="sc-bdVaJa eDCunu" href="/api/requestPromiseAdapter">requestPromiseAdapter</a></div></div></div><style data-emotion-css="b95f0i">.css-b95f0i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex:1;-ms-flex:1;flex:1;}</style><main class="css-b95f0i e1qy7fsr0"><style data-emotion-css="pcbh56">.css-pcbh56{display:block;-webkit-flex:1;-ms-flex:1;flex:1;position:relative;padding:1.5rem;margin-bottom:3rem;}</style><div class="css-pcbh56 e20rco30"><style data-emotion-css="fkj7ih">.css-fkj7ih{position:relative;margin-left:auto;margin-right:auto;width:auto;max-width:60em;}</style><div class="css-fkj7ih e1c6zxln0"><h1>API Reference</h1><h2>class DeclaredAPI</h2><h3>method implement<!-- -->WithMiddleware</h3></div><section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Purpose</h4>Implements an API using express</section><section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Usage</h4>Instead of calling the methods on an express app or router yourself, you use this function to have papupata do it for you.</section><section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Parameters</h4><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>middleware</td><td>Function[]</td><td>An array of express middleware functions.</td></tr><tr><td>implementation</td><td>Function</td><td>A function that implements the route. Specified as follows<section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Parameters</h4><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>req</td><td>Request</td><td>This is a typed express request -- that is, body, params and query have been replaced with typed versions of themselves.</td></tr><tr><td>res</td><td>Response</td><td>Express response corresponding to the request.</td></tr></tbody></table></section><section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Returns</h4>ResponseType, ServerResponseType, or a promise of either</section><ul><li>Do note that the &quot;next&quot; parameter typically used in routes is not present</li><li>Anything thrown (includes returned rejected promises) is given to the usual next function</li><li>If undefined is returned, nothing is sent automatically. This could at times explain hanging requests. Of course, unless you explicitly declared the API to return undefined, you should see type errors, too.</li></ul></td></tr></tbody></table></section><section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Returns</h4>Nothing</section><section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Caveats</h4><ul><li>Either application of router must be configured or the function throws</li><li>You can implement an API multiple times, but it is unlikely to do you any good.</li><li>There is at this time no way to cleanly implement an API that does not just return its value, and instead, say, streams it.</li></ul></section><section class="sc-gzVnrw ibZhkv"><h4 class="sc-htoDjs bZzhDu">Examples</h4><h5 class="sc-dnqmqq bDsesi">Declaration</h5><div class="sc-bZQynM bOrPFB"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">import</span> { APIDeclaration } <span style="color:#954121">from</span> <span style="color:#219161">&#x27;papupata&#x27;</span>
<span style="color:#954121">const</span> api = <span style="color:#954121">new</span> APIDeclaration()
<span style="color:#954121">const</span> myAPI = api.declarePostAPI(<span style="color:#219161">&#x27;/do-stuff/:param&#x27;</span>)
  .params([<span style="color:#219161">&#x27;param&#x27;</span>] <span style="color:#954121">as</span> <span style="color:#954121">const</span>)
  .query([<span style="color:#219161">&#x27;q&#x27;</span>] <span style="color:#954121">as</span> <span style="color:#954121">const</span>)
  .body({key: <span style="color:#0086b3">string</span>})
  .response&lt;<span style="color:#0086b3">string</span>&gt;()</code></pre></div><h5 class="sc-dnqmqq bDsesi">Usage in implementation</h5><div class="sc-bZQynM bOrPFB"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">await</span> myAPI.implementWithMiddleware(
  [<span class="hljs-function">(<span style="color:#00f">req, res, next</span>) =&gt;</span> { <span style="color:#0086b3">console</span>.log(req.url); next() }],
  <span class="hljs-function">(<span style="color:#00f">req, res</span>) =&gt;</span> {
  <span style="color:#954121">const</span> {q} = req.query,
    {param} = req.params,
    {key} = req.body
  res.set(<span style="color:#219161">&#x27;x-my-header&#x27;</span>, <span style="color:#219161">&#x27;Hello&#x27;</span>)
  <span style="color:#954121">return</span> [param, q, key].join()
})            </code></pre></div><h5 class="sc-dnqmqq bDsesi">Usage in invocation</h5><div class="sc-bZQynM bOrPFB"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code><span style="color:#954121">const</span> response = <span style="color:#954121">await</span> myAPI({param: <span style="color:#219161">&#x27;abc&#x27;</span>, q: <span style="color:#219161">&#x27;def&#x27;</span>, key: <span style="color:#219161">&#x27;ghi&#x27;</span>})            
<span style="color:#408080;font-style:italic">// Response in the example will be abc,def,ghi</span></code></pre></div></section></div></main></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/api/DeclaredAPI/implementWithMiddleware/";window.webpackCompilationHash="005959cdff446533b1f2";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-be965acda842c5448fb8.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-c0993ce04df9d0573b52.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-4d8ff9c2b0d216d1c597.js"],"component---src-pages-api-api-declaration-tsx":["/component---src-pages-api-api-declaration-tsx-b649ac4a50b5e69fb7de.js"],"component---src-pages-api-api-declaration-configure-tsx":["/component---src-pages-api-api-declaration-configure-tsx-14bcf1662a12f42886dc.js"],"component---src-pages-api-api-declaration-declare-delete-api-tsx":["/component---src-pages-api-api-declaration-declare-delete-api-tsx-14156b82d30e88487f08.js"],"component---src-pages-api-api-declaration-declare-get-api-tsx":["/component---src-pages-api-api-declaration-declare-get-api-tsx-60360a944419371e26bf.js"],"component---src-pages-api-api-declaration-declare-post-api-tsx":["/component---src-pages-api-api-declaration-declare-post-api-tsx-936d22a588ab6289eee6.js"],"component---src-pages-api-api-declaration-declare-put-api-tsx":["/component---src-pages-api-api-declaration-declare-put-api-tsx-943384298fcc8fb8cb24.js"],"component---src-pages-api-declared-api-tsx":["/component---src-pages-api-declared-api-tsx-b517dcfd3b80eeec7b57.js"],"component---src-pages-api-declared-api-body-type-tsx":["/component---src-pages-api-declared-api-body-type-tsx-3fec1f31af3970a74db4.js"],"component---src-pages-api-declared-api-call-args-type-tsx":["/component---src-pages-api-declared-api-call-args-type-tsx-15d56f5d796144cf3533.js"],"component---src-pages-api-declared-api-get-url-tsx":["/component---src-pages-api-declared-api-get-url-tsx-9898e11b79604e4c0fd6.js"],"component---src-pages-api-declared-api-implement-tsx":["/component---src-pages-api-declared-api-implement-tsx-8fa91f8ad60dd0a54f87.js"],"component---src-pages-api-declared-api-implement-with-middleware-tsx":["/component---src-pages-api-declared-api-implement-with-middleware-tsx-38c7ace3cb2b9817551e.js"],"component---src-pages-api-declared-api-invoke-tsx":["/component---src-pages-api-declared-api-invoke-tsx-2d1f77f38f44689f0a74.js"],"component---src-pages-api-declared-api-request-type-tsx":["/component---src-pages-api-declared-api-request-type-tsx-35c28b438db0eef6f97f.js"],"component---src-pages-api-declared-api-response-type-tsx":["/component---src-pages-api-declared-api-response-type-tsx-6a8986176bee1cd5fc7e.js"],"component---src-pages-api-declared-api-server-response-type-tsx":["/component---src-pages-api-declared-api-server-response-type-tsx-9c948f3b9628f69cbd3f.js"],"component---src-pages-api-fetch-adapter-tsx":["/component---src-pages-api-fetch-adapter-tsx-32261dad50f2e5de5570.js"],"component---src-pages-api-incomplete-api-declaration-tsx":["/component---src-pages-api-incomplete-api-declaration-tsx-7963f2142faf2a18dbf5.js"],"component---src-pages-api-incomplete-api-declaration-body-tsx":["/component---src-pages-api-incomplete-api-declaration-body-tsx-1d99f0d1136d94dd4519.js"],"component---src-pages-api-incomplete-api-declaration-optional-query-tsx":["/component---src-pages-api-incomplete-api-declaration-optional-query-tsx-76fef89623d32ef921ef.js"],"component---src-pages-api-incomplete-api-declaration-params-tsx":["/component---src-pages-api-incomplete-api-declaration-params-tsx-8f1bab6c516f7049731b.js"],"component---src-pages-api-incomplete-api-declaration-query-tsx":["/component---src-pages-api-incomplete-api-declaration-query-tsx-3ee373123097853a8214.js"],"component---src-pages-api-incomplete-api-declaration-query-bool-tsx":["/component---src-pages-api-incomplete-api-declaration-query-bool-tsx-e8ac4f878c2f7674b5cf.js"],"component---src-pages-api-incomplete-api-declaration-response-tsx":["/component---src-pages-api-incomplete-api-declaration-response-tsx-f201436c92f10cc70bd5.js"],"component---src-pages-api-request-promise-adapter-tsx":["/component---src-pages-api-request-promise-adapter-tsx-d0d05bb31f2166e54d87.js"],"component---src-pages-getting-started-tsx":["/component---src-pages-getting-started-tsx-def0d1e66a48f3300c98.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-e223fbc1fc2a283e345d.js"],"component---src-pages-page-2-tsx":["/component---src-pages-page-2-tsx-6f6088ecebe2a63db043.js"]};/*]]>*/</script><script src="/component---src-pages-api-declared-api-implement-with-middleware-tsx-38c7ace3cb2b9817551e.js" async=""></script><script src="/2-1e0f04a221fa422f9089.js" async=""></script><script src="/1-9232275627ef4d5a43ec.js" async=""></script><script src="/styles-55dc67248799c1c1094b.js" async=""></script><script src="/app-be965acda842c5448fb8.js" async=""></script><script src="/webpack-runtime-b250d0c9b07cb4c16ee5.js" async=""></script></body></html>