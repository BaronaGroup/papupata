<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/papupata/styles.3deb5e37fbd9f45aa579.css" id="gatsby-global-css">/*! modern-normalize v1.0.0 | MIT License | https://github.com/sindresorhus/modern-normalize */*,:after,:before{box-sizing:border-box}:root{-moz-tab-size:4;-o-tab-size:4;tab-size:4}html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}hr{height:0;color:inherit}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted ButtonText}:-moz-ui-invalid{box-shadow:none}legend{padding:0}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}</style><meta name="generator" content="Gatsby 2.32.11"/><link rel="canonical" href="https://gatsby-starter-typescript-plus.netlify.com/guides/server/middleware/" data-baseprotocol="https:" data-basehost="gatsby-starter-typescript-plus.netlify.com"/><title data-react-helmet="true">Papupata Documentation</title><meta data-react-helmet="true" name="description" content="Documentation for the typescript library papupata, for utilizing types for AJAX requests."/><meta data-react-helmet="true" name="keywords"/><link as="script" rel="preload" href="/papupata/framework-4aeac2b3fca5c098d555.js"/><link as="script" rel="preload" href="/papupata/commons-f2b9c522b1c1cf066d83.js"/><link as="script" rel="preload" href="/papupata/component---src-pages-guides-server-middleware-tsx-fa27605d464f50fee0b6.js"/><link as="script" rel="preload" href="/papupata/5367c54182bad8c557b49b29c3e7cd0a79049056-cb673f1bc6be78558fdf.js"/><link as="script" rel="preload" href="/papupata/app-597116e06919b9f2d6de.js"/><link as="script" rel="preload" href="/papupata/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/papupata/webpack-runtime-73ecf9970afbb23ac565.js"/><link as="fetch" rel="preload" href="/papupata/page-data/guides/server/middleware/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/papupata/page-data/sq/d/1963140206.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/papupata/page-data/sq/d/2219842477.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/papupata/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="u9b51k">html{box-sizing:border-box;}*,*::before,*::after{box-sizing:inherit;}html{font-size:16px !important;line-height:1.45 !important;}body{width:100%;overflow-x:hidden;overflow-y:scroll;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif;color:#000;background-color:#fff;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;}a{color:#663399;-webkit-text-decoration:none;text-decoration:none;}a:hover,a:focus{-webkit-text-decoration:underline;text-decoration:underline;}img{max-width:100%;object-fit:contain;position:relative;}figure{margin:2rem 0;}figcaption{font-size:80%;}table{width:100%;margin-bottom:1rem;border:1px solid #f5f3f7;font-size:85%;border-collapse:collapse;}td,th{padding:.25rem .5rem;border:1px solid #f5f3f7;}th{text-align:left;}tbody tr:nth-of-type(odd) td{background-color:#fbfafc;}tbody tr:nth-of-type(odd) tr{background-color:#fbfafc;}h1,h2,h3,h4,h5,h6{margin-top:1.414rem;margin-bottom:.5rem;color:#000;font-weight:600;line-height:1.2;text-rendering:optimizeLegibility;}h1{margin-top:0;font-size:2.441rem;}h2{font-size:1.953rem;}h3{font-size:1.563rem;}h4,h5,h6{font-size:1.25rem;}p{margin-top:0;margin-bottom:1rem;}strong{color:#000;}ul,ol,dl{margin-top:0;margin-bottom:1rem;}dt{font-weight:bold;}dd{margin-bottom:.5rem;}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #f5f3f7;}blockquote{margin:.8rem 0;padding:.5rem 1rem;border-left:.25rem solid #f5f3f7;color:rgba(0,0,0,0.54);}blockquote p:last-child{margin-bottom:0;}@media (min-width:48em){blockquote{padding-right:5rem;padding-left:1.25rem;}}</style><style data-emotion-css="zf0iqh">.css-zf0iqh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}</style><div class="css-zf0iqh e1qi6hgo0"><style data-emotion-css="1atnuaa">.css-1atnuaa{height:60px;padding:0 1.5rem;background-color:#663399;color:rgba(255,255,255,0.5);}</style><header class="css-1atnuaa ew8ynk80"><style data-emotion-css="voneje">.css-voneje{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;}</style><style data-emotion-css="8gr2bf">.css-8gr2bf{position:relative;margin-left:auto;margin-right:auto;width:auto;max-width:60em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;}</style><div class="ew8ynk81 css-8gr2bf euf2zmc0"><style data-emotion-css="1u0571z">.css-1u0571z{color:#fff;font-size:1.5rem;font-weight:600;}.css-1u0571z:hover,.css-1u0571z:focus{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-1u0571z ew8ynk82" href="/papupata/">Papupata Documentation</a></div></header><div class="sc-iqHYGH hSaKRS"><div class="sc-iBPRYJ cOWINi"><h2 class="sc-fubCfw irPtrP">Table of contents</h2><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/what-is-papupata">What is papupata?</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/getting-started">Getting started</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/concepts">Concepts and terms</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides">Guides</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/declaring">Declaring APIs</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/declaring">Basics</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/declaring/typeMapping">Types for path and query</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/declaring/query-based-variants">Query-based variants</a></div></label></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/metadata">Accessing metadata</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/sharing">Sharing APIs declarations</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides?client">Clients</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/client/setup">Setting up papupata</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/client/calling">Calling APIs</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/client/customRequestAdapters">Custom request adapters</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/client/testing">Testing</a></div></label></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides?server">Servers</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/server/setup">Setting up papupata</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/server/implementing">Implementing APIs</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/server/interactingWithExpress">Interacting with express</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/server/middleware">Middleware</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/server/testing">Testing</a></div></label></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/guides/migrationToV2">Migrating to papupata 2.x</a></div></label></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api-reference">API Reference</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration">class APIDeclaration</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/configure"><span>configure<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/declareDeleteAPI"><span>declareDeleteAPI<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/declareGetAPI"><span>declareGetAPI<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/declarePostAPI"><span>declarePostAPI<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/declarePatchAPI"><span>declarePatchAPI<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/declarePutAPI"><span>declarePutAPI<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/getConfig"><span>getConfig<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/unmockAll"><span>unmockAll<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/APIDeclaration/updateConfig"><span>updateConfig<!-- -->()</span></a></div></label></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI">PartiallyDeclaredAPI</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI/params"><span>params<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI/query"><span>query<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI/optionalQuery"><span>optionalQuery<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI/queryBool"><span><span class="sc-jrAGrp dXWCyY">queryBool</span>()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI/body"><span>body<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI/response"><span>response<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/PartiallyDeclaredAPI/TypeMapping"><span class="sc-pFZIQ gbgfMs">TypeMapping</span></a></div></label></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><span class="sc-eCssSg hmocIu">&gt;</span><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI">DeclaredAPI</a></div><div class="sc-hKgILt gTLZXx"><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/invoke"><span>invoke<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/getURL"><span>getURL<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/implement"><span>implement<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/implementation"><span class="sc-kEjbxe jbJDWL">implementation</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/implementationMiddleware"><span class="sc-kEjbxe jbJDWL">implementationMiddleware</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/implementWithMiddleware"><span>implementWithMiddleware<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/implementWithExpressMiddleware"><span>implementWithExpressMiddleware<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/implementWithPapupataMiddleware"><span>implementWithPapupataMiddleware<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/mock"><span>mock<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/mockOnce"><span>mockOnce<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/unmock"><span>unmock<!-- -->()</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/method"><span class="sc-kEjbxe jbJDWL">method</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/apiDeclaration"><span class="sc-kEjbxe jbJDWL">apiDeclaration</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/apiUrlParameters"><span class="sc-kEjbxe jbJDWL">apiUrlParameters</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/path"><span class="sc-kEjbxe jbJDWL">path</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/ResponseType"><span class="sc-pFZIQ gbgfMs">ResponseType</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/ServerResponseType"><span class="sc-pFZIQ gbgfMs">ServerResponseType</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/BodyType"><span class="sc-pFZIQ gbgfMs">BodyType</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/CallArgsType"><span class="sc-pFZIQ gbgfMs">CallArgsType</span></a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/DeclaredAPI/RequestType"><span class="sc-pFZIQ gbgfMs">RequestType</span></a></div></label></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/convertExpressMiddleware">convertExpressMiddleware</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/skipHandlingRoute">skipHandlingRoute</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/handleUndefinedResponsesMiddleware">handleUndefinedResponsesMiddleware</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/fetchAdapter">fetchAdapter</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/requestPromiseAdapter">requestPromiseAdapter</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/supertestAdapter">supertestAdapter</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/supertestInvoker">supertestInvoker</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/invokeImplementationAdapter">invokeImplementationAdapter</a></div></label><label class="sc-gKsewC gnwqMi"><input type="checkbox" class="sc-jSgupP ckDfJz"/><div class="sc-bdfBwQ cIKpxU"><a current="false" class="sc-gsTCUz dFfFa-d" href="/papupata/api/testInvoker">testInvoker</a></div></label></div></label></div><style data-emotion-css="b95f0i">.css-b95f0i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex:1;-ms-flex:1;flex:1;}</style><main class="css-b95f0i e1mc0fse0"><style data-emotion-css="pcbh56">.css-pcbh56{display:block;-webkit-flex:1;-ms-flex:1;flex:1;position:relative;padding:1.5rem;margin-bottom:3rem;}</style><div class="css-pcbh56 e1cg1sy10"><style data-emotion-css="fkj7ih">.css-fkj7ih{position:relative;margin-left:auto;margin-right:auto;width:auto;max-width:60em;}</style><div class="css-fkj7ih euf2zmc0"><h1>Guide: middleware</h1><section class="sc-dQppl cQZIoF"><h4 class="sc-bqyKva ehfErK">Overview</h4>Middleware provides powerful additional functionality to how APIs behave. This guide goes through how middleware is used and created.</section><div><section class="sc-dQppl cQZIoF"><h4 class="sc-bqyKva ehfErK">Table of contents</h4><ul><li style="margin-left:0"><a href="#whatis">What is middleware?</a></li><li style="margin-left:0"><a href="#using">Using middleware</a></li><li style="margin-left:0"><a href="#basic">The most basic middleware</a></li><li style="margin-left:0"><a href="#request">Manipulating request</a></li><li style="margin-left:0"><a href="#abandoning">Abandoning the request</a></li><li style="margin-left:0"><a href="#response">Manipulating response</a></li><li style="margin-left:0"><a href="#options">Route options</a></li><li style="margin-left:0"><a href="#errors">Error handling</a></li><li style="margin-left:0"><a href="#express">Express middleware</a></li></ul></section><section id="whatis" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">What is middleware?</h4><p>Much like express middleware, papupata middleware exists to separate common functionality needed by APIs from the actual API implementations.</p><p>There are two types of middleware:</p><ul><li>Middleware inherent to an API declaration, which is applied to all of the declared APIs. This could be called global middleware, but since it only applies to a single API declaration it could be misleading.</li><li>API-specific middleware, which is only applied when explicitly requested.</li></ul><p>The middleware generally speaking do one or all of the following things:</p><ul><li>Manipulate the request before passing it along to the API implementation</li><li>Preventing the API from being called under specific circumstances</li><li>Manipulate the output of an API</li><li>Add a side-effect to an API being invoked</li></ul></section><section id="using" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">Using middleware</h4><p>Both inherent and route-specific middleware is given in an array. The order of the elements matters: inherent middleware is always processed before route-specific middleware, and within the array all middleware are processed in the same order as they exist in the array. This can be important if, say, one middleware adds data to request another middleware depends on, or if you want to block the execution of the middleware as well based on a condition.</p><p>Configuring inherent middleware: </p><div class="sc-giIncl gHUUHu"><select><option value="1.x">Papupata 1.x</option><option selected="" value="2.x">Papupata 2.x</option></select><div class="sc-ezrdKe bAYFRD">Older styles are still supported in later versions, just not preferred.</div><div><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span>API.updateConfig({
</span><span>  </span><span class="hljs-attr">inherentMiddleware</span><span>: [myMiddleware1, myMiddleware1]
</span>})
</code></pre></div></div></div><p>Configuring middleware for a single route: </p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myAPI = API.declareGetAPI(</span><span style="color:#219161">&#x27;/test&#x27;</span><span>).response&lt;</span><span style="color:#0086b3">string</span><span>&gt;()
</span>
<!-- -->myAPI.implementWithPapupataMiddleware([myMiddleware1, myMiddleware1], implementation)
</code></pre></div><p>You can use express middleware with papupata, see more in the <a href="#express">express section of this guide</a>.</p></section><section id="basic" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">The most basic middleware</h4><p>Let&#x27;s start by creating a middleware that simply logs the URLs being invoked.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> {PapupataMiddleware} </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;papupata&#x27;</span><span>
</span><span></span><span style="color:#954121">import</span><span> {Request} </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;express&#x27;</span><span>
</span><span></span><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;Request, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res, api, next</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>    </span><span style="color:#0086b3">console</span><span>.log(</span><span style="color:#219161">&#x27;Handling&#x27;</span><span>, req.url)
</span><span>    </span><span style="color:#954121">return</span><span> next()
</span>}
</code></pre></div><p>The main difference between express and papupata middleware is that while express middleware forms a list, papupata middleware are more like koa middleware in that there is a call stack, or a pyramid where each middleware can be a part of both the request and the response. The important thing for most middleware is to return the value returned by calling<!-- --> <span class="sc-jJEJSO laquCT">next()</span> instead ignoring it.</p><p>Errors are handled by throwing exceptions.</p></section><section id="request" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">Manipulating request</h4><p>In theory manipulating the request is just changing data in it.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;Request, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res, api, next</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>    </span><span style="color:#954121">if</span><span> (req.body?.userId === </span><span style="color:#219161">&#x27;self&#x27;</span><span>) {
</span>        req.body.userId = req.session.userId
<!-- -->    }
<span>    </span><span style="color:#954121">return</span><span> next()
</span>}
</code></pre></div><p>Typescript does make some kinds of changes more difficult. If you want to add custom fields, you probably want to extend the <span class="sc-jJEJSO laquCT">request</span> interface to contain whatever you are adding.</p><p>Sometimes though these modifications might only be relevant for single papupata API declarations and you don&#x27;t want to change the global request interface. For this reason papupata supports changing the request type to something other than the default.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">interface</span><span> MyRequest </span><span style="color:#954121">extends</span><span> Request {
</span><span>  </span><span class="hljs-attr">myField</span><span>: </span><span style="color:#0086b3">string</span><span>
</span>}
<!-- -->
<span></span><span style="color:#954121">const</span><span> API = </span><span style="color:#954121">new</span><span> APIDeclaration&lt;MyRequest&gt;()
</span>
<span> </span><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;MyRequest, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res, api, next</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  </span><span style="color:#954121">if</span><span> (req.body?.userId === </span><span style="color:#219161">&#x27;self&#x27;</span><span>) {
</span>      req.body.userId = req.session.userId
<!-- -->  }
<span>  </span><span style="color:#954121">return</span><span> next()
</span>                }
</code></pre></div><p>In the example both the implementations and middleware on API use the MyRequest instead of the normal Request type for the request parameter.</p></section><section id="abandoning" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">Abandoning the request</h4><p>Sometimes middleware needs to prevent the actual implemementation from being called. There are multiple way to do this depending on what your goal is. There is always one thing in common though: you don&#x27;d call next.</p><ul><li>Return a value. It then becomes the response instead of what the implementation would have provided<div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;MyRequest, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res, api, next</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  </span><span style="color:#954121">if</span><span> (!req.headers.accept?.includes(</span><span style="color:#219161">&#x27;application/json&#x27;</span><span>)) {
</span><span>      res.status(</span><span style="color:#40a070">400</span><span>)
</span><span>      </span><span style="color:#954121">return</span><span> </span><span style="color:#219161">&#x27;Bad headers&#x27;</span><span>
</span>  }
<span>  </span><span style="color:#954121">return</span><span> next()
</span>}
</code></pre></div></li><li>Throw an error to do normal error handling<div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;MyRequest, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res, api, next</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  </span><span style="color:#954121">if</span><span> (!req.headers.accept?.includes(</span><span style="color:#219161">&#x27;application/json&#x27;</span><span>)) {
</span><span>      </span><span style="color:#954121">throw</span><span> </span><span style="color:#954121">new</span><span> </span><span style="color:#0086b3">Error</span><span>(</span><span style="color:#219161">&#x27;Bad headers&#x27;</span><span>)
</span>  }
<span>  </span><span style="color:#954121">return</span><span> next()
</span>}
</code></pre></div></li><li>Explicitly send a response using the methods on <span class="sc-jJEJSO laquCT">res</span>. This prevents other middleware from being able to affect the response.<div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;MyRequest, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res, api, next</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  </span><span style="color:#954121">if</span><span> (!req.headers.accept?.includes(</span><span style="color:#219161">&#x27;application/json&#x27;</span><span>)) {
</span><span>      res.status(</span><span style="color:#40a070">400</span><span>)
</span><span>      res.send(</span><span style="color:#219161">&#x27;Bad request: Invalid headers&#x27;</span><span>)
</span><span>      </span><span style="color:#954121">return</span><span>
</span>  }
<span>  </span><span style="color:#954121">return</span><span> next()
</span>}
</code></pre></div></li><li>Return <span class="sc-jJEJSO laquCT">skipHandlingRoute</span> to have express resume routing and middleware processing with other APIs.<div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> {skipHandlingRoute} </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;papupata&#x27;</span><span>
</span><span></span><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;MyRequest, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span class="hljs-function">(</span><span class="hljs-function" style="color:#00f">req, res, api, next</span><span class="hljs-function">) =&gt;</span><span> {
</span><span>  </span><span style="color:#954121">if</span><span> (!req.headers.accept?.includes(</span><span style="color:#219161">&#x27;application/json&#x27;</span><span>)) {
</span><span>      </span><span style="color:#954121">return</span><span> skipHandlingRoute
</span>  }
<span>  </span><span style="color:#954121">return</span><span> next()
</span>}
</code></pre></div></li></ul></section><section id="response" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">Manipulating response</h4><p>Normally a middleware gets the response data by doing <span class="sc-jJEJSO laquCT">await next()</span>, and it can then do whatever manipulation it desires. Some APIs can send the response directly though, in which case this is not true, so you should try and be prepared for it.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;MyRequest, </span><span style="color:#0086b3">void</span><span>&gt; = </span><span style="color:#954121">async</span><span> (req, res, api, next) =&gt; {
</span><span>  </span><span style="color:#954121">const</span><span> value = </span><span style="color:#954121">await</span><span> next()
</span><span>  </span><span style="color:#954121">if</span><span> (!res.headersSent) {
</span><span>    res.status(</span><span style="color:#40a070">204</span><span>)
</span><span>    </span><span style="color:#954121">return</span><span> value ?? </span><span style="color:#219161">&#x27;No data&#x27;</span><span>
</span>  }
<span>  </span><span style="color:#954121">return</span><span> value
</span>}
</code></pre></div></section><section id="options" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">Route options</h4><p>It&#x27;d be really convenient to give middleware some metadata about a route. Is unauthenticated access permitted? Does it handle unusual payloads? Papupata allows exactly that.</p><p>When you create an API declaration you can provide an interface that provides options to routes, and provide a value of that type to the APIs.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> {Request} </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;express&#x27;</span><span>
</span><span></span><span style="color:#954121">interface</span><span> Options { publicAccess: </span><span style="color:#0086b3">boolean</span><span> }
</span><span></span><span style="color:#954121">const</span><span> API = </span><span style="color:#954121">new</span><span> APIDeclaration&lt;Request, Options&gt;()
</span><span></span><span style="color:#954121">const</span><span> myAPI = API.declareGetAPI(</span><span style="color:#219161">&#x27;/api/ping&#x27;</span><span>, {</span><span class="hljs-attr">publicAccess</span><span>: </span><span style="color:#954121">true</span><span>}).response&lt;</span><span style="color:#0086b3">string</span><span>&gt;()</span></code></pre></div><p>This value can then be accessed by middleware.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;Request, Options&gt; = </span><span style="color:#954121">async</span><span> (req, res, api, next) =&gt; {
</span><span>  </span><span style="color:#954121">if</span><span> (!api.options?.publicAccess &amp;&amp; !req.session.isValid) {
</span><span>    </span><span style="color:#954121">throw</span><span> </span><span style="color:#954121">new</span><span> </span><span style="color:#0086b3">Error</span><span>(</span><span style="color:#219161">&#x27;Authentication required&#x27;</span><span>)
</span>  }
<span>  </span><span style="color:#954121">return</span><span> next()
</span>}
</code></pre></div></section><section id="errors" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">Error handling</h4><p>You can use middleware to add custom error handling.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">const</span><span> myMiddleware: PapupataMiddleware&lt;Request, Options&gt; = </span><span style="color:#954121">async</span><span> (req, res, api, next) =&gt; {
</span><span>  </span><span style="color:#954121">try</span><span> {
</span><span>    </span><span style="color:#954121">return</span><span> </span><span style="color:#954121">await</span><span> next()
</span><span>  } </span><span style="color:#954121">catch</span><span>(err) {
</span><span>    res.status(err.status || </span><span style="color:#40a070">400</span><span>)
</span><span>    </span><span style="color:#954121">return</span><span> err.message
</span>  }
<!-- -->}
</code></pre></div></section><section id="express" class="sc-dQppl cQZIoF"><h4 class="sc-kLgntA iHaOcn">Express middleware</h4><p>Individual routes can be given express middleware in addition to papupata middleware. If you do that, the express middleware is run before the papupata middleware is -- even the inherent middleware.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span>myAPI.implementWithExpressMiddleware([expressMiddleware], implement)
</span><span>myAPI.implementWithMiddleware({</span><span class="hljs-attr">express</span><span>: [expressMiddleware]}, implement)</span></code></pre></div><p>A generally preferable option is to convert express middleware into papupata middleware;<!-- --> <span class="sc-jJEJSO laquCT">convertExpressMiddleware</span> is exported by papupata to do that. At this time it does not handle express middleware that handle errors, but other middleware should be convertable.</p><div class="sc-crrsfI iDhzRL"><pre style="display:block;overflow-x:auto;padding:0.5em;color:#000;background:#f8f8ff"><code class="language-typescript" style="white-space:pre"><span style="color:#954121">import</span><span> {convertExpressMiddleware} </span><span style="color:#954121">from</span><span> </span><span style="color:#219161">&#x27;papupata&#x27;</span><span>
</span>myAPI.implementWithPapupataMiddleware([convertExpressMiddleware(expressMiddleware)], implement)
</code></pre></div></section></div></div></div></main></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/guides/server/middleware/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-6b9f32eaf727cc1e68de.js"],"app":["/app-597116e06919b9f2d6de.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-145ace273840d89a263b.js"],"component---src-pages-api-api-declaration-configure-tsx":["/component---src-pages-api-api-declaration-configure-tsx-113009166a97be64b942.js"],"component---src-pages-api-api-declaration-declare-delete-api-tsx":["/component---src-pages-api-api-declaration-declare-delete-api-tsx-92d31c36b677b41a63df.js"],"component---src-pages-api-api-declaration-declare-get-api-tsx":["/component---src-pages-api-api-declaration-declare-get-api-tsx-d18e94d77d91e5cebdde.js"],"component---src-pages-api-api-declaration-declare-patch-api-tsx":["/component---src-pages-api-api-declaration-declare-patch-api-tsx-07559c98c2bcfd6b3b93.js"],"component---src-pages-api-api-declaration-declare-post-api-tsx":["/component---src-pages-api-api-declaration-declare-post-api-tsx-e1f5053b1f1fd145d088.js"],"component---src-pages-api-api-declaration-declare-put-api-tsx":["/component---src-pages-api-api-declaration-declare-put-api-tsx-e1195a10701c4501b039.js"],"component---src-pages-api-api-declaration-get-config-tsx":["/component---src-pages-api-api-declaration-get-config-tsx-1d2094ade4bcf0c18998.js"],"component---src-pages-api-api-declaration-tsx":["/component---src-pages-api-api-declaration-tsx-485a014646e2f8f36e8e.js"],"component---src-pages-api-api-declaration-unmock-all-tsx":["/component---src-pages-api-api-declaration-unmock-all-tsx-aaa2b4d3e2db9c1ff3c5.js"],"component---src-pages-api-api-declaration-update-config-tsx":["/component---src-pages-api-api-declaration-update-config-tsx-2ca1f27e884270bf76ad.js"],"component---src-pages-api-convert-express-middleware-tsx":["/component---src-pages-api-convert-express-middleware-tsx-042b2308d3aa4a4245d6.js"],"component---src-pages-api-declared-api-api-declaration-tsx":["/component---src-pages-api-declared-api-api-declaration-tsx-2edbe86d94275691258d.js"],"component---src-pages-api-declared-api-api-url-parameters-tsx":["/component---src-pages-api-declared-api-api-url-parameters-tsx-e1ee574b8aba1c971958.js"],"component---src-pages-api-declared-api-body-type-tsx":["/component---src-pages-api-declared-api-body-type-tsx-0e0c6746e192bd5928a0.js"],"component---src-pages-api-declared-api-call-args-type-tsx":["/component---src-pages-api-declared-api-call-args-type-tsx-85b2567d8523ff458bf0.js"],"component---src-pages-api-declared-api-get-url-tsx":["/component---src-pages-api-declared-api-get-url-tsx-847938771061180d0ab9.js"],"component---src-pages-api-declared-api-implement-base-tsx":["/component---src-pages-api-declared-api-implement-base-tsx-1a89ea6543332229438f.js"],"component---src-pages-api-declared-api-implement-tsx":["/component---src-pages-api-declared-api-implement-tsx-f0bc3b231e01ad026706.js"],"component---src-pages-api-declared-api-implement-with-express-middleware-tsx":["/component---src-pages-api-declared-api-implement-with-express-middleware-tsx-647abf4feefc4f2a4529.js"],"component---src-pages-api-declared-api-implement-with-middleware-tsx":["/component---src-pages-api-declared-api-implement-with-middleware-tsx-3d8edf84b428002568ae.js"],"component---src-pages-api-declared-api-implement-with-papupata-middleware-tsx":["/component---src-pages-api-declared-api-implement-with-papupata-middleware-tsx-1f6f88cfe75f2fd07f21.js"],"component---src-pages-api-declared-api-implementation-middleware-tsx":["/component---src-pages-api-declared-api-implementation-middleware-tsx-7af02cbe42127d30ff57.js"],"component---src-pages-api-declared-api-implementation-tsx":["/component---src-pages-api-declared-api-implementation-tsx-16b4c877e98eff8ac772.js"],"component---src-pages-api-declared-api-invoke-tsx":["/component---src-pages-api-declared-api-invoke-tsx-a3be46577e3bfa658dc3.js"],"component---src-pages-api-declared-api-method-tsx":["/component---src-pages-api-declared-api-method-tsx-5ceaa4fb839723b6c962.js"],"component---src-pages-api-declared-api-mock-once-tsx":["/component---src-pages-api-declared-api-mock-once-tsx-665da31c0a1b7448432e.js"],"component---src-pages-api-declared-api-mock-tsx":["/component---src-pages-api-declared-api-mock-tsx-83c7670ac0fbd3bfa05a.js"],"component---src-pages-api-declared-api-path-tsx":["/component---src-pages-api-declared-api-path-tsx-7415c5f12ae283df36cd.js"],"component---src-pages-api-declared-api-request-type-tsx":["/component---src-pages-api-declared-api-request-type-tsx-c3cea6692ef8519b2cd3.js"],"component---src-pages-api-declared-api-response-type-tsx":["/component---src-pages-api-declared-api-response-type-tsx-405ed4a4fee97e166e0e.js"],"component---src-pages-api-declared-api-server-response-type-tsx":["/component---src-pages-api-declared-api-server-response-type-tsx-1c7c4e41e05ae8d70fd9.js"],"component---src-pages-api-declared-api-tsx":["/component---src-pages-api-declared-api-tsx-a9e6a623423677bd464c.js"],"component---src-pages-api-declared-api-unmock-tsx":["/component---src-pages-api-declared-api-unmock-tsx-8b6d16fbdb2ad25e90d5.js"],"component---src-pages-api-fetch-adapter-tsx":["/component---src-pages-api-fetch-adapter-tsx-787e6838eeeb85b31fc4.js"],"component---src-pages-api-handle-undefined-responses-middleware-tsx":["/component---src-pages-api-handle-undefined-responses-middleware-tsx-747e59d86201ef9ca21c.js"],"component---src-pages-api-invoke-implementation-adapter-tsx":["/component---src-pages-api-invoke-implementation-adapter-tsx-8bf5f2f628d90f50a504.js"],"component---src-pages-api-partially-declared-api-body-tsx":["/component---src-pages-api-partially-declared-api-body-tsx-2f60bb415162887979f6.js"],"component---src-pages-api-partially-declared-api-optional-query-tsx":["/component---src-pages-api-partially-declared-api-optional-query-tsx-f2e91a922ea9a81cc524.js"],"component---src-pages-api-partially-declared-api-params-tsx":["/component---src-pages-api-partially-declared-api-params-tsx-9e62df452f71e3ea7c97.js"],"component---src-pages-api-partially-declared-api-query-bool-tsx":["/component---src-pages-api-partially-declared-api-query-bool-tsx-b81210e4d95e0ea9e311.js"],"component---src-pages-api-partially-declared-api-query-tsx":["/component---src-pages-api-partially-declared-api-query-tsx-d3253ccd68316a8fd436.js"],"component---src-pages-api-partially-declared-api-response-tsx":["/component---src-pages-api-partially-declared-api-response-tsx-5fdc8efe70a7f299ead6.js"],"component---src-pages-api-partially-declared-api-tsx":["/component---src-pages-api-partially-declared-api-tsx-f8d9787b895e2160900b.js"],"component---src-pages-api-partially-declared-api-type-mapping-tsx":["/component---src-pages-api-partially-declared-api-type-mapping-tsx-97322d7e7ee5e7e89bc3.js"],"component---src-pages-api-request-promise-adapter-tsx":["/component---src-pages-api-request-promise-adapter-tsx-688be344a3277091b3b0.js"],"component---src-pages-api-skip-handling-route-tsx":["/component---src-pages-api-skip-handling-route-tsx-f15279eb35d2e9749806.js"],"component---src-pages-api-supertest-adapter-tsx":["/component---src-pages-api-supertest-adapter-tsx-6bd01bacda0ee60871e6.js"],"component---src-pages-api-supertest-invoker-tsx":["/component---src-pages-api-supertest-invoker-tsx-4a3519e04a53ee2a32fc.js"],"component---src-pages-api-test-invoker-tsx":["/component---src-pages-api-test-invoker-tsx-7a0d2347cacad1496bed.js"],"component---src-pages-concepts-tsx":["/component---src-pages-concepts-tsx-a89737674c9a7ac8a50e.js"],"component---src-pages-getting-started-tsx":["/component---src-pages-getting-started-tsx-b611a2ff1bb41cf1edce.js"],"component---src-pages-guides-client-calling-tsx":["/component---src-pages-guides-client-calling-tsx-d2f9bb6ce68585da0aab.js"],"component---src-pages-guides-client-custom-request-adapters-tsx":["/component---src-pages-guides-client-custom-request-adapters-tsx-e0589a83d53ac3e92c7c.js"],"component---src-pages-guides-client-setup-tsx":["/component---src-pages-guides-client-setup-tsx-61e8d124f174d29c1c27.js"],"component---src-pages-guides-client-testing-tsx":["/component---src-pages-guides-client-testing-tsx-dab92a695f15668f43c2.js"],"component---src-pages-guides-declaring-query-based-variants-tsx":["/component---src-pages-guides-declaring-query-based-variants-tsx-23a7aa062183492d37ac.js"],"component---src-pages-guides-declaring-tsx":["/component---src-pages-guides-declaring-tsx-1c9fbe27503cff5df72f.js"],"component---src-pages-guides-declaring-type-mapping-tsx":["/component---src-pages-guides-declaring-type-mapping-tsx-856af8b942e4f7504d72.js"],"component---src-pages-guides-metadata-tsx":["/component---src-pages-guides-metadata-tsx-cb02b3ce8704a97e8098.js"],"component---src-pages-guides-migration-to-v-2-tsx":["/component---src-pages-guides-migration-to-v-2-tsx-6c1a91644cd033e6c74c.js"],"component---src-pages-guides-server-implementing-tsx":["/component---src-pages-guides-server-implementing-tsx-0c27040d1b07ce227c06.js"],"component---src-pages-guides-server-interacting-with-express-tsx":["/component---src-pages-guides-server-interacting-with-express-tsx-febac9f12d4cbbb73054.js"],"component---src-pages-guides-server-middleware-tsx":["/component---src-pages-guides-server-middleware-tsx-fa27605d464f50fee0b6.js"],"component---src-pages-guides-server-setup-tsx":["/component---src-pages-guides-server-setup-tsx-138f3e3a2ecc034381c5.js"],"component---src-pages-guides-server-testing-tsx":["/component---src-pages-guides-server-testing-tsx-5f12acf5999a8ae80f36.js"],"component---src-pages-guides-sharing-tsx":["/component---src-pages-guides-sharing-tsx-3da9b1f940cb1e9aee6c.js"],"component---src-pages-guides-tsx":["/component---src-pages-guides-tsx-a79049caba1bd6ec91c9.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-01a4cb6a3ba43c0a3b96.js"],"component---src-pages-page-2-tsx":["/component---src-pages-page-2-tsx-d09f8a620429528a1a1e.js"],"component---src-templates-page-tsx":["/component---src-templates-page-tsx-9a3c2bb6106f6c294a18.js"]};/*]]>*/</script><script src="/papupata/polyfill-6b9f32eaf727cc1e68de.js" nomodule=""></script><script src="/papupata/webpack-runtime-73ecf9970afbb23ac565.js" async=""></script><script src="/papupata/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/papupata/app-597116e06919b9f2d6de.js" async=""></script><script src="/papupata/5367c54182bad8c557b49b29c3e7cd0a79049056-cb673f1bc6be78558fdf.js" async=""></script><script src="/papupata/component---src-pages-guides-server-middleware-tsx-fa27605d464f50fee0b6.js" async=""></script><script src="/papupata/commons-f2b9c522b1c1cf066d83.js" async=""></script><script src="/papupata/framework-4aeac2b3fca5c098d555.js" async=""></script></body></html>