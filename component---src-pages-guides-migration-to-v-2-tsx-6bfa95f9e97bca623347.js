(self.webpackChunkpapupata_docs=self.webpackChunkpapupata_docs||[]).push([[5222],{1040:function(e,t,n){"use strict";n.d(t,{P:function(){return a}});var a=n(7294).createContext(!1)},8567:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(5444),r=(n(7294),n(3431));function l(){return(0,r.tZ)(a.rU,{to:"/api/PartiallyDeclaredAPI/TypeMapping"},"TypeMapping")}},2275:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var a,r,l=n(6848),o=n(7294),u=n(366),i=n(3431),s=u.ZP.div(a||(a=(0,l.Z)(["\n  border-left: 4px solid #663399;\n  padding: 5px 0 5px 10px;\n"]))),p=u.ZP.div(r||(r=(0,l.Z)(["\n  display: inline-block;\n  margin-left: 10px;\n  font-size: 0.9em;\n"])));function d(e){var t=e.variants,n=e.isRecommendation,a=(0,o.useState)("2.x"),r=a[0],l=a[1],u=(0,o.useCallback)((function(e){l(e.target.value)}),[]);return(0,i.tZ)(s,null,(0,i.tZ)("select",{value:r,onChange:u},(0,i.tZ)("option",{value:"1.x"},"Papupata 1.x"),(0,i.tZ)("option",{value:"2.x"},"Papupata 2.x")),n&&(0,i.tZ)(p,null,"Older styles are still supported in later versions, just not preferred."),Object.keys(t).filter((function(e){return function(e,t){return"*"===t||t===e}(r,e)})).map((function(e){return(0,i.tZ)("div",{key:e},t[e])})))}},1724:function(e,t,n){"use strict";n.d(t,{$0:function(){return g},OT:function(){return v},ag:function(){return P},cY:function(){return I},l1:function(){return q},aE:function(){return A},d2:function(){return k},pR:function(){return x},by:function(){return T},yV:function(){return F},en:function(){return j},iT:function(){return E},Vo:function(){return C},lS:function(){return Q}});var a,r,l,o,u,i,s,p,d,h=n(6848),c=n(366),Z=n(7294),m=n(1808),f=n(1040),y=n(3431),g=c.ZP.section(a||(a=(0,h.Z)([""]))),v=c.ZP.h4(r||(r=(0,h.Z)([""]))),b=c.ZP.h5(l||(l=(0,h.Z)([""]))),w=c.ZP.section(o||(o=(0,h.Z)(["\n  padding: 15px 30px;\n  background: lightyellow;\n"]))),P=function(e){var t=e.children;return(0,y.tZ)(g,null,(0,y.tZ)(v,null,"Purpose"),t)},I=function(e){var t=e.version;return(0,y.tZ)(g,null,(0,y.tZ)(v,null,"Availability"),"This functionality is available from papupata version ",t," onwards.")},q=function(e){var t=e.children;return(0,y.tZ)(g,null,(0,y.tZ)(v,null,"Usage"),t)},A=function(e){var t=e.children,n=e.includeAvailableFrom,a=e.label;return(0,y.tZ)(g,null,(0,y.tZ)(f.P.Provider,{value:!!n},(0,y.tZ)(v,null,"Parameters",a&&": "+a),t?(0,y.tZ)("table",null,(0,y.tZ)("thead",null,(0,y.tZ)("tr",null,(0,y.tZ)("th",null,"Name"),(0,y.tZ)("th",null,"Type"),(0,y.tZ)("th",null,"Description"),n&&(0,y.tZ)("th",null,"Introduced in"))),(0,y.tZ)("tbody",null,t)):(0,y.tZ)("p",null,"There are no parameters.")))},k=function(e){var t=e.children,n=e.name,a=e.dataType,r=e.availableFrom,l=void 0===r?"1.0.0":r,o=Z.useContext(f.P);return(0,y.tZ)("tr",null,(0,y.tZ)("td",null,n),(0,y.tZ)("td",null,a),(0,y.tZ)("td",null,t),o&&(0,y.tZ)("td",null,l))},x=function(e){var t=e.children;return(0,y.tZ)(g,null,(0,y.tZ)(v,null,"Returns"),t)},T=function(e){var t=e.children;return(0,y.tZ)(g,null,(0,y.tZ)(v,null,"Caveats"),t)},F=function(e){var t=e.children;return(0,y.tZ)(g,null,(0,y.tZ)(v,null,"Examples"),t)},j=function(e){var t=e.children,n=e.label;return(0,y.tZ)(Z.Fragment,null,n&&(0,y.tZ)(b,null,n),(0,y.tZ)(m.E,{language:"typescript"},t))},E=function(e){var t=e.children;return(0,y.tZ)(w,null,(0,y.tZ)(b,null,"Common to examples below:"),t)},C=function(e){var t=e.children,n=e.includeAvailableFrom;return(0,y.tZ)(g,null,(0,y.tZ)(v,null,"Type parameeters"),(0,y.tZ)(f.P.Provider,{value:!!n},(0,y.tZ)(v,null,"Parameters"),t?(0,y.tZ)("table",null,(0,y.tZ)("thead",null,(0,y.tZ)("tr",null,(0,y.tZ)("th",null,"Name"),(0,y.tZ)("th",null,"Default value"),(0,y.tZ)("th",null,"Description"),n?(0,y.tZ)("th",null,"Introduced in"):"")),(0,y.tZ)("tbody",null,t)):(0,y.tZ)("p",null,"There are no parameters.")))},D=c.ZP.tr(u||(u=(0,h.Z)([""]))),O=c.ZP.td(i||(i=(0,h.Z)([""]))),U=c.ZP.td(s||(s=(0,h.Z)([""]))),B=c.ZP.td(p||(p=(0,h.Z)([""]))),S=c.ZP.td(d||(d=(0,h.Z)([""]))),Q=function(e){var t=e.children,n=e.name,a=e.defaultValue,r=e.availableFrom,l=void 0===r?"none":r,o=Z.useContext(f.P);return(0,y.tZ)(D,null,(0,y.tZ)(O,null,n),(0,y.tZ)(U,null,a),(0,y.tZ)(B,null,t),o?(0,y.tZ)(S,null,l):"")}},5361:function(e,t,n){"use strict";n.d(t,{g2:function(){return p},eC:function(){return c},If:function(){return Z}});var a,r,l,o=n(6848),u=(n(7294),n(1724)),i=n(366),s=n(3431);function p(e){var t=e.children;return(0,s.tZ)(u.$0,null,(0,s.tZ)(u.OT,null,"Overview"),t)}var d=i.ZP.h4(a||(a=(0,o.Z)([""]))),h=i.ZP.h5(r||(r=(0,o.Z)(["\n  font-size: 1.1em;\n"])));function c(e){var t=e.content;return(0,s.tZ)("div",null,(0,s.tZ)(u.$0,null,(0,s.tZ)(u.OT,null,"Table of contents"),(0,s.tZ)("ul",null,t.map((function(e){return(0,s.tZ)("li",{style:{marginLeft:18*(e.level||0)},key:e.anchor},(0,s.tZ)("a",{href:"#"+e.anchor},e.heading))})))),t.map((function(e){var t=e.level?h:d;return(0,s.tZ)(u.$0,{id:e.anchor,key:e.anchor},(0,s.tZ)(t,null,e.heading),e.content)})))}var Z=i.ZP.span(l||(l=(0,o.Z)(["\n  font-family: 'Consolas', 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace;\n"])))},3080:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});n(1879);var a=n(5444),r=n(7294),l=n(1724),o=n(832),u=n(5361),i=n(7614),s=n(8567),p=n(2275),d=n(387),h=n(3431);function c(){return(0,h.tZ)(d.Z,null,(0,h.tZ)(i.Z,null,(0,h.tZ)(o.Z,null,(0,h.tZ)("h1",null,"Guide: Migrating to papupata 2.x"),(0,h.tZ)(u.g2,null,"There are no major incompatibilities from 1.x to 2.x, but there may well be a few things you'll have to change as you upgrade. This guide covers those, as well as giving a brief overview of the new additions."),(0,h.tZ)(u.eC,{content:[{heading:"Breaking changes",anchor:"breaking",content:(0,h.tZ)("p",null,"As this is a major version upgrade, there are some breaking changes.")},{heading:"autoImplementAllAPIs default to true",anchor:"autoImplementAllAPIs",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"The default value for the configuration option ",(0,h.tZ)(u.If,null,"autoImplementAllAPIs")," is now true. This change will affect you if you have not used the setting, use papupata on the server and have routes declared with papupata but not implemented with it."),(0,h.tZ)("p",null,"The result is that such APIs will start returning 501, unless express (or something else) handles them before papupata gets to."),(0,h.tZ)("p",null,"For a workaround, the easiest solution is to explcitly set the setting to false."),(0,h.tZ)(l.en,null,"\n                      API.configure({\n                        ...otherOptions,\n                        autoImplementAllAPIs: false,\n                      })\n                      "),(0,h.tZ)("p",null,"You could also update your APIs to either work with this setting, or set the"," ",(0,h.tZ)(u.If,null,"disableAutoImplement")," option to true on the affected routes."))},{heading:"Imports from withing papupata package have been restructured",anchor:"deepImports",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"In papupata 1.x there were files that were imported from ",(0,h.tZ)(u.If,null,"papupata/dist"),"; that is no longer supported and such imports must be updated according as follows."),(0,h.tZ)("table",null,(0,h.tZ)("thead",null,(0,h.tZ)("tr",null,(0,h.tZ)("th",null,"Old import"),(0,h.tZ)("th",null,"New import"))),(0,h.tZ)("tbody",null,(0,h.tZ)("tr",null,(0,h.tZ)("td",null,"papupata/dist/main/fetchAdapter"),(0,h.tZ)("td",null,"papupata/adapters/fetch")),(0,h.tZ)("tr",null,(0,h.tZ)("td",null,"papupata/dist/main/invokeImplementationAdapter"),(0,h.tZ)("td",null,"papupata/adapters/invokeImplementation")),(0,h.tZ)("tr",null,(0,h.tZ)("td",null,"papupata/dist/main/request-promise-adapter"),(0,h.tZ)("td",null,"papupata/adapters/requestPromise")),(0,h.tZ)("tr",null,(0,h.tZ)("td",null,"papupata/dist/main/supertestAdapter"),(0,h.tZ)("td",null,"papupata/adapters/supertest")),(0,h.tZ)("tr",null,(0,h.tZ)("td",null,"papupata/dist/main/supertestInvoker"),(0,h.tZ)("td",null,"papupata/invokers/supertest")),(0,h.tZ)("tr",null,(0,h.tZ)("td",null,"papupata/dist/main/testInvoker"),(0,h.tZ)("td",null,"papupata/invokers/test")))))},{heading:"ES6 support is now required",anchor:"es6",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"Typescript is now configured to use ES6 as its compilation target, as that is required for Error to be subclassed properly with ES classes."),(0,h.tZ)("p",null,"If this turns out to be a problem for you, please submit an issue and we can look in to creating a browser build that still compiles to ES5."))},{heading:"apiUrlParameters on a declared API has had its type changed",anchor:"apiUrlParameters",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"The ",(0,h.tZ)(a.rU,{to:"/api/DeclaredAPI/apiUrlParameters"},"apiUrlParameters property")," has had its type changed. It used to contain arrays of strings, but now it contains ",(0,h.tZ)(s.Z,null)," objects instead. It is not very likely that you've used this field, and if you have it's most likely in middleware."),(0,h.tZ)("p",null,"For existing APIs you can get the old format with:"),(0,h.tZ)(l.en,null,"\n                      const oldStyleParameters = {\n                        params: Object.keys(api.apiUrlParameters.params),\n                        query: Object.keys(api.apiUrlParameters.query),\n                        optionalQuery: Object.keys(api.apiUrlParameters.optionalQuery),\n                        boolQuery: Object.keys(api.apiUrlParameters.boolQuery),\n                      }\n                    "),(0,h.tZ)("p",null,"Do note that for APIs that use the new style typed query parameters there will be nothing in boolQuery even if there are boolean parameters."))},{heading:"Presence of required query parameters is verified",anchor:"requiredQueryParams",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"Papupata 1.x allowed you to declare required query parameters, and while the types indicated they were required, no effort was made to ensure they were actually present. This is no longer the case, and missing required query parameters are considered a validation error."),(0,h.tZ)("p",null,"By default this means that papupata will throw a PapupataValidationError, which can be handle by express middleware, but there is no way get to the actual route implementation or any middleware with missing query parameters."),(0,h.tZ)("p",null,"The only fix is to move all of the optional query parameters from ",(0,h.tZ)(u.If,null,"query")," to"," ",(0,h.tZ)(u.If,null,"optionalQuery"),", where they should've been all along."))},{heading:"Features supported by qs but not by papupata",anchor:"qsFeatures",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"Requests typically have their query parameters parsed by qs, and papupata has just taken whatever values qs has produced and assumed it's all good. This is no longer the case, and papupata ensures that everything in the request query conforms to what has been declared in the API declaration (albeit additional fields can still exist)."),(0,h.tZ)("p",null,'For the most part this should not be a problem, but if you have done some interesting things like passing arrays with "as any" you\'ll probably have to make some changes.'))},{heading:"Request adapters can receive undefined as the body",anchor:"requestAdapterUndefinedBody",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"In papupata 1.x request adapters always got a body, which normally was an object. The only situation where it might not be an object was if you specifically invoked an API that had a non-object body that was passed to papupata."),(0,h.tZ)("p",null,"Now, if the body would be an empty object, undefined is passed to request adapters instead. This makes it easier not to accidentally send empty bodies with GET requests, for example, while still allowing them to be present for DELETE requests, if required. (while DELETE is not meant to have a body, it is not entirely unknown for it to be used with one)"),(0,h.tZ)("p",null,"You might have to update your custom request adapters to deal with the undefined body, with something along the lines of"),(0,h.tZ)(l.en,null,"const actualBody = body ?? {}"),(0,h.tZ)("p",null,"As this does easily cause the API implementation not to receive any body even if it has been declared to be an object, papupata's own middleware makes the body be an empty object if it would otherwise be undefined."))},{heading:"Middleware is applied to automatically implemented routes",anchor:"501middleware",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"Routes that are are automatically implemented (to return a 501) thanks to ",(0,h.tZ)(u.If,null,"autoImplementAllAPIs")," ","being set to true (which is now the default) are subject to any middeware set up on the papupata API declaration itself."),(0,h.tZ)("p",null,"This allows logging middleware etc. to work properly even when the APIs are not implemented, but it does mean that the middleware is called in situations where it was not before."))},{heading:"Deprecated functionality",anchor:"deprecations",content:(0,h.tZ)("p",null,"Some old features are still supported, but considered deprecated and should be avoided.")},{heading:"Arrays for declaring query and path parameters",anchor:"arrays",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"In papupata 1.x all path and query parameters were declared as const arrays. In 2.x it is now possible, and recommended that you instead use ",(0,h.tZ)(s.Z,null)," objects to declare the parameters. The main advantages are never again forgetting the ",(0,h.tZ)(u.If,null,"as const")," and being able to use a variety of types for the parameters instead of just strings."),(0,h.tZ)(p.Z,{variants:{"1.x":(0,h.tZ)(l.en,null,"\n                            const api = API.declareGetAPI('/path/:id')\n                              .params(['id'] as const)\n                              .query(['query'] as const)\n                              .optionalQuery(['limit', 'startFrom'] as const)\n                              .response<any>()\n                           "),"2.x":(0,h.tZ)(l.en,null,"\n                            const api = API.declareGetAPI('/path/:id')\n                              .params({ id: Number })\n                              .query({ query: String })\n                              .optionalQuery({ limit: Number, startFrom: Date}})\n                              .response<any>()\n                          ")}}))},{heading:"queryBool",anchor:"queryBool",level:1,content:(0,h.tZ)(r.Fragment,null,(0,h.tZ)("p",null,"Declaring boolean query parameters with queryBool is no longer recommended, instead they should be declared as normal or optional query parameters with boolean type."),(0,h.tZ)(p.Z,{variants:{"1.x":(0,h.tZ)(l.en,null,"\n                          const api = API.declareGetAPI('/path')\n                            .queryBool(['myParam'] as const)\n                            .response<any>()\n                           "),"2.x":(0,h.tZ)(l.en,null,"\n                              const api = API.declareGetAPI('/path')\n                                .query({ myParam: Boolean }})\n                                .response<any>()\n                          ")}}),(0,h.tZ)("p",null,'Do however not that this it not a perfect match for the old behavior; in 1.x any values other than the string "true" were treated as false, whereas in 2.x the only permitted values are the string "true", "false" and an empty string (which also stands for false). If the parameters is optional, undefined is also valid value but remains undefined instead of becoming false.'))},{heading:"Configuration option makeRequest is now requestAdapter",anchor:"requestAdapter",level:1,content:(0,h.tZ)("p",null,"In order to be more consistent with the documentation, the configuration option ",(0,h.tZ)(u.If,null,"makeRequest")," is now instead ",(0,h.tZ)(u.If,null,"requestAdapter"),". The old name can still be used, however.")}]}))))}}}]);
//# sourceMappingURL=component---src-pages-guides-migration-to-v-2-tsx-6bfa95f9e97bca623347.js.map